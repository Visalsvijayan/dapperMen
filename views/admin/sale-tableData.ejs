

<%- include("../../views/partials/admin/header") %>
<style>
  .maindiv{
    width: 80%;
     margin-left: auto;
  }
  .btn {
  margin-right: 10px;
  margin-top: 50px;
}
@media print {
  body {
    width: 100%;
    margin: 0;
    padding: 0;
  }
  .table {
    page-break-inside: avoid;
  }
}
td {
  word-break: break-all;
  white-space: normal !important;
}
</style>
<!-- Put this inside your body, inside your page layout -->
<div class=" maindiv my-4" >
  
  <div class="d-flex justify-content-end mb-3">
    <button class="btn btn-success " onclick="downloadPDF()">Download PDF</button>
    <button class="btn btn-primary" onclick="downloadExcel()">Download Excel</button>
  </div>
<div id="reportContent">
  <div class="bg-white p-4 shadow rounded">
    <h1 class="text-center mb-1">Male Fashion</h1>
    <h4 class="text-center mb-4">Sales Report</h4>

    <div class="mb-3">
      <p><strong>Report Range:</strong>–
        <%if(sortBy==='custom'){%>
          <%=startDate%> - <%=endDate%>
        <%}else if(sortBy==='weekly'){%>
          Weekly Report 
        <%}else if(sortBy==='monthly'){%>
          Monthly Report
        <%}else if(sortBy==='daily'){%>
          Daily Roprt 
        <%}else{%>
          Yearly Report
        <%}%>     
        
      </p>
      <p><strong>Generated On:</strong><%=new Date().toLocaleDateString('en-GB')%></p>
    </div>

    <div class="table-responsive mb-5">
      <table  class="table table-bordered" style="width: 100%; font-size: 11px; table-layout: auto;">
        <tbody>
          <%if(salesSummery&&salesSummery.length>0){%>
          <tr>
            <td><strong>Total Sales</strong></td>
            <td><%=salesSummery[0].netSale%></td>
            <td><strong>Total Orders</strong></td>
            <td><%=salesSummery[0].totalOrder%></td>
          </tr>
          <tr>
            <td><strong>Products Sold</strong></td>
            <td><%=salesSummery[0].numberOfProducts%></td>
            <td><strong>Coupon Discounts </strong></td>
            <td>₹<%=salesSummery[0].netCoupon%></td>
          </tr>
          <tr>
            <td><strong>Offer Discount</strong></td>
            <td>₹<%=salesSummery[0].netProductOffer%></td>
            <td><strong>Avg. Order Value</strong></td>
            <% if (salesSummery.length > 0) { %>
              <% 
              const avgOrderValue = salesSummery[0].totalOrder > 0 
                ? Math.round((salesSummery[0].netSale / salesSummery[0].totalOrder) * 100) / 100 
                : 0; 
              %>
              <td>₹<%= avgOrderValue %></td>
            <% } %>
          </tr>

          <%}else{%>
            <h1>No orders</h1>
          <%}%>  
        </tbody>
      </table>
    </div>

    <h5 class="mb-3">Order Details</h5>

    <div class="table-responsive">
      <table id="orderTable" class="table table-bordered table-striped">
        <thead class="table-light">
          <tr>
            <th>Order ID</th>
            <th>Customer</th>
            <th>Date</th>
            <th>Payment</th>
            <th>Status</th>
            <th>Discount</th>
            <th>Total (₹)</th>
          </tr>
        </thead>
        <tbody>
          <%if(salesData&&salesData.length>0){%>
            <%salesData.forEach((order)=>{%>
          <tr>
            <td><%=order.orderId%></td>
            <td><%=order.userName%></td>
            <td><%= new Date(order.createdOn).toLocaleDateString('en-GB') %></td>
            <td>
              <%=order.payment==='cod'? 'Cash On Delivery':order.payment%>
            </td>
            <td><%=order.status%></td>
            <td><%=order.totalOfferAmount%></td>
            <td><%=order.finalAmount%></td>
          </tr>
          <%})%>
          <%}else{%>
            <td>No data</td>
          <%}%>  
        </tbody>
        <!-- <tfoot>
          <tr>
            <td colspan="5" class="text-end"><strong>Grand Total</strong></td>
            <td><strong>₹0</strong></td>
            <td><strong>₹1,750</strong></td>
          </tr>
        </tfoot> -->
      </table>
    </div>

    <div class="text-center text-muted mt-4 small">
      Generated by Male Fashion<br>
      © 2025 All Rights Reserved
    </div>
  </div>

</div>
 

</div>
<%- include("../../views/partials/admin/footer") %>
<!-- Scripts for PDF and Excel download -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

<script>
// function downloadPDF() {
//   const element = document.getElementById('reportContent');
//   html2pdf().from(element).save('Sales_Report.pdf');
// }
function downloadPDF() {
  const element = document.getElementById('reportContent');
  const opt = {
    margin: 10,
    filename: 'Sales_Report.pdf',
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2 },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }
  };
  html2pdf().set(opt).from(element).save();
}

function downloadExcel() {
  const table = document.getElementById('orderTable');
  const wb = XLSX.utils.table_to_book(table, {sheet: "Sales Report"});
  XLSX.writeFile(wb, 'Sales_Report.xlsx');
}
</script>
